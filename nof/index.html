<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="../images/brain_favicon.ico">

    <!-- Experiment Title -->
    <title>My Awesome Experiment</title>

    <!-- Psych.js Imports -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <script src='https://psychjs.alecneuro.com/index.min.js'></script>
    <!-- <script src='../src/index.js'></script> -->
    <!-- Psych.js Imports End -->

</head>
<body id='root'>

    <script>

        // Create settings
        function Settings() {

            var dims = Psych.dims();

            return {
                id: {
                    trialnum: 0,
                    cong: 1
                },
                keys: {
                    cong_right: ['H', 'Z'],
                    cong_left: ['S', 'X'],
                    get_cong_as_string: function(side) {
                        switch(side) {
                            case 'left':
                                return this.cong_left.join('')
                            case 'right':
                                return this.cong_right.join('')
                            default:
                                return null
                        }
                    }
                },
                locations: {
                    center_top: dims.height / 6 * 2,
                    center_left: dims.width / 2,
                    right_left: dims.width / 16 * 10,
                    bottom_top: dims.height / 4 * 3,
                    left_left: dims.width / 16 * 6
                }
            }

        }

        function Trialseq(settings) {

            const cols = Object.keys(settings.id).length;
            const trialseq = new Matrix(5, cols);


            // Last step, add trial numbers to everything
            const [rows] = trialseq.shape();
            const trialnums = Matrix.range(1, rows, 1);
            trialseq.setColFromArray(settings.id.trialnum, trialnums);

            return trialseq

        }

        function ScreenItems(settings) {

            const leftText = Psych.divWithText({
                text: settings.keys.get_cong_as_string('left'),
                color: 'white',
                letterSpacing: '2px',
                fontSize: '2.5em'
            }, {
                backgroundColor: 'black',
                borderRadius: '5px',
                height: '100px',
                width: '150px',
                left: `${settings.locations.left_left}px`,
                top: `${settings.locations.bottom_top}px`
            });

            const rightText = Psych.divWithText({
                text: settings.keys.get_cong_as_string('right'),
                color: 'white',
                letterSpacing: '2px',
                fontSize: '2.5em'
            }, {
                backgroundColor: 'black',
                borderRadius: '5px',
                height: '100px',
                width: '150px',
                left: `${settings.locations.right_left}px`,
                top: `${settings.locations.bottom_top}px`
            });

            const centerText = Psych.divWithText({
                text: 'SSHSS',
                color: 'white',
                letterSpacing: '2px',
                fontSize: '2.5em',
                margin: '0px',
                padding: '0px',
                fontWeight: 'normal'
            }, {
                backgroundColor: 'black',
                borderRadius: '5px',
                height: '100px',
                width: '150px',
                padding: '25px',
                left: `${settings.locations.center_left}px`,
                top: `${settings.locations.center_top}px`
            });

            const triangleUp = Psych.makeShape('triangle', {
                lineWidth: 25,
                size: 400,
                fillStyle: 'transparent',
                top: settings.locations.center_top,
                left: settings.locations.center_left
            });

            const triangleDown = Psych.makeShape('triangle', {
                lineWidth: 25,
                size: 400,
                rotate: 180,
                fillStyle: 'transparent',
                top: settings.locations.center_top,
                left: settings.locations.center_left
            });

            const screenItems = [leftText, rightText, triangleUp, triangleDown, centerText];

            return {
                leftText,
                rightText,
                centerText,
                triangleUp,
                triangleDown,
                items: function() {
                    return [this.leftText, this.rightText, this.centerText, this.triangleUp, this.triangleDown]
                }
            }

        }

        (async () => {

            // Init Psych.js (This MUST be called for Psych.js to work properly)
            Psych.init({
                backgroundColor: 'white',
                textColor: 'black'
            });

            const settings = Settings();
            const screenItems = ScreenItems(settings);

            // Enter full screen mode
            // await Psych.fullScreen();
            
            // you can now insert text into the DOM

            const trialseq = Trialseq(settings);
            // trialseq.print();
            console.log(Object.keys(settings.id))
            console.table(trialseq.values, ['hi', 'one']);
            
            Psych.prepare(screenItems.items());
            
            // text is now in the DOM but the user cannot see it
            
            Psych.display(screenItems.items());

            await (new PsychTime()).waitUntil(1000);

            // Psych.clear();

            // Exit full screen mode
            // await Psych.exitFullScreen();

        })();

    </script>

</body>
</html>